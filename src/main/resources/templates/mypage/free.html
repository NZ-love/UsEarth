<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/css/mypage/mycommunity.css">
    <title>UsEarth-내가 작성한 글</title>
</head>
<body>
<div id="nuxt">
    <div id="layout">
        <div>
            <div>
                <div class="headerLayout">
                    <div class="headerWrapper">
                        <div class="topBar">
                            <div class="application newGrid container" style="background-color: inherit;">
                                <div class="application newRow">
                                    <div class="application newCol1 newCol2">
                                        <div class="topBarContainer">
                                            <div class="topBarBackward">
                                                <svg data-v-bd9f2bcc="" data-v-09aeb421="" width="24" height="24" viewBox="0 0 24 24" fill="black" xmlns="http://www.w3.org/2000/svg" class="back pointer iconLink application icon0" data-v-59015b26="" style="fill: rgb(60, 65, 68);"><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M4.21913 11.3753C3.92696 11.7405 3.92696 12.2595 4.21913 12.6247L8.21913 17.6247C8.56414 18.056 9.19343 18.1259 9.62469 17.7809C10.056 17.4359 10.1259 16.8066 9.78087 16.3753L6.28062 12L9.78087 7.6247C10.1259 7.19344 10.056 6.56415 9.62469 6.21914C9.19343 5.87413 8.56414 5.94405 8.21913 6.37531L4.21913 11.3753Z"></path><path data-v-bd9f2bcc="" fill-rule="evenodd" clip-rule="evenodd" d="M20 12C20 11.4477 19.5523 11 19 11H6C5.44771 11 5 11.4477 5 12C5 12.5523 5.44771 13 6 13H19C19.5523 13 20 12.5523 20 12Z"></path></svg>
                                                <div class="topTitle application typography body1" style="color: rgb(4,5,5); font-weight: 500;">내가 작성한 글</div>
                                            </div>
                                            <div class="topBarContent">
                                                <div class="flex alignCenter">
                                                    <ul class="flex inform3 headerInfoSectionList"></ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="fakeHeader noSub"></div>
                    </div>
                    <div class="noTiDrawer"></div>
                </div>
            </div>
            <div id="mainGrid" class="application newGrid mainGridComponent fluid" style="min-height: calc(100vh - 324px); background-color: rgb(252,252,252)">
                <div class="application newRow">
                    <div class="application newCol1 myPageContainer newCol2 newCol3">
                        <div class="application newGrid fluid" style="background-color: inherit;">
                            <div class="application newRow">
                                <div class="application newCol1 myPageArticle newCol2 newCol5">
                                    <div class="application newCol1 newCol2 newCol3 noGutters">
                                        <div class="application newGrid myPageNavContainer fluid" style="background-color: rgb(255,255,255);">
                                            <div class="application newRow">
                                                <div class="application newGrid fluid" style="background-color: inherit">
                                                    <div class="application newRow noGutters">
                                                        <div class="swiperContainer application tabsMenuContainer swiper myPageNav swiperContainerInitialized swiperContainerHorizontal swiperContainerFreeMode">
                                                            <div class="swiperWrapper">
                                                                <div class="all swiperSlide swiperSlideActive">
                                                                    <div class="all tabsMenuButton">
                                                                            <a href="/mypage/community"  class="LinkExactActive">
                                                                                <button class="application cButton medium primary fill">
                                                                                    <div class="buttonIcon"></div>
                                                                                    민원목록
                                                                                    <div class="buttonIcon"></div>
                                                                                </button>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                    <div class="swiperSlide swiperSlideNext">
                                                                        <div class="tabsMenuButton">
                                                                            <a href="/mypage/recycling"  class="LinkExactActive">
                                                                                <button class="application cButton medium primary fill">
                                                                                    <div class="buttonIcon"></div>
                                                                                    재활용 대행
                                                                                    <div class="buttonIcon"></div>
                                                                                </button>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                    <div class="swiperSlide swiperSlideNext active">
                                                                        <div class="tabsMenuButton">
                                                                            <a href="/mypage/free"  class="LinkExactActive">
                                                                                <button class="application cButton medium primary fill">
                                                                                    <div class="buttonIcon"></div>
                                                                                    자유게시판
                                                                                    <div class="buttonIcon"></div>
                                                                                </button>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                    <div class="swiperSlide swiperSlideNext">
                                                                        <div class="tabsMenuButton">
                                                                            <a href="/mypage/reply"  class="LinkExactActive">
                                                                                <button class="application cButton medium primary fill">
                                                                                    <div class="buttonIcon"></div>
                                                                                    내 댓글
                                                                                    <div class="buttonIcon"></div>
                                                                                </button>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            <span class="swiperNotification" aria-live="assertive" aria-atomic="true"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="fakeMyPageNav"></div>
                                    </div>
                                    <div class="application newCol1 myPageCommunity newCol6 newCol3 noGutters first">
                                        <div>
                                            <div class="application List myPageCommunityList"></div>
                                        </div>
                                        <div class="infiniteLoadingContainer" style="display: none">
                                            <div class="infiniteStatusPrompt" style="display: none">
                                                <div>
                                                    <div style="width: 50px; height: 50px; overflow: hidden; margin: 0 auto;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" width="100" height="100" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px); content-visibility: visible;"><defs><clipPath id="__lottie_element_82"><rect width="100" height="100" x="0" y="0"></rect></clipPath></defs><g clip-path="url(#__lottie_element_82)"><g transform="matrix(0.6223319172859192,0,0,0.6223319172859192,18.883403778076172,18.883403778076172)" opacity="0.5" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,50,50)"><path fill="rgb(42,125,225)" fill-opacity="1" d=" M40,0 C40,22.090999603271484 22.090999603271484,40 0,40 C-22.090999603271484,40 -40,22.090999603271484 -40,0 C-40,-22.090999603271484 -22.090999603271484,-40 0,-40 C22.090999603271484,-40 40,-22.090999603271484 40,0z"></path></g></g><g transform="matrix(0.3776680827140808,0,0,0.3776680827140808,31.116596221923828,31.116596221923828)" opacity="0.5" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,50,50)"><path fill="rgb(42,125,225)" fill-opacity="1" d=" M40,0 C40,22.090999603271484 22.090999603271484,40 0,40 C-22.090999603271484,40 -40,22.090999603271484 -40,0 C-40,-22.090999603271484 -22.090999603271484,-40 0,-40 C22.090999603271484,-40 40,-22.090999603271484 40,0z"></path></g></g></g></svg>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="infiniteStatusPrompt" style>
                                                    <span>
                                                        <div class="application cBox myPageNoResultsBox" style="background-color: rgb(255,255,255); padding: 16px">
                                                            <div class="topTitle application typography body1" style="color: rgb(118,125,130); text-align: center;">
                                                                <span>"앗! 아직 활동내역이 없습니다."
                                                                        <br>
                                                                     "게시글을 등록하고 자유롭게 이야기를 나눠보세요."
                                                                </span>
                                                            </div>
                                                            <button class="goButton application cButton medium lightPrimary fill">
                                                                <div class="buttonIcon"></div>
                                                                <div class="topTitle application typography regular" style="color: inherit">커뮤니티 입장하기</div>
                                                                <div class="buttonIcon"></div>
                                                            </button>
                                                        </div>
                                                    </span>
                                            </div>
                                            <!--                                            -->
                                            <div class="infiniteStatusPrompt" style="display: none">
                                                <div>
                                                    <div class="applicationList">
                                                        <div class="communityList">
                                                            <div class="typography" style="color: rgb(173, 179, 184);">
                                                                <div class="justify">
                                                                    <div class="align">
                                                                        <div class="semi-bold" style="color: rgb(118, 125, 130);">카테 고리</div>
                                                                    </div>
                                                                    <div class="align">
                                                                        <button type="button" class="narrow-button"  style="color: rgb(118, 125, 130);">
                                                                            <div class="button--icon"></div>
                                                                            취소
                                                                            <div class="button--icon"></div>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <div class="ListTitle" style="color: rgb(60, 65, 68);">제목</div>
                                                                <div class="flexColumn">
                                                                    <div class="text-right" style="color: rgb(173, 179, 184);">시간</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr style="border-color: rgb(243, 244, 245);" class="applicationHr">
                                                    </div>
                                                </div>
                                            </div>
                                            <!--                                            -->
                                            <div class="infiniteStatusPrompt" style="color: rgb(102,102,102); font-size: 14px; padding: 10px 0; display:none;" >
                                                "Opps, something went wrong :("
                                                <br>
                                                <button class="reTry">Retry</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div></div>
        </div>
    </div>
</div>
</body>
<script src="/js/mypage/mycommunity.js"></script>
<script th:inline="javascript">
    const infiniteLoadingContainer=document.querySelector(".infiniteLoadingContainer");
    // 페이징 밑 무한 스크롤
    let page = 1;
    let isLoading = false;
    const first=document.querySelector(".first");
    // 서버에서 데이터를 가져오는 메소드
    async function getPosts() {
        // fetch에 데이터를 가져 올 주소 입력
        const response = await fetch("/lists/api/free/1")
        const posts = await response.json();
        const reversedPosts = posts.reverse(); // 최신순으로 가져오도록 역순으로 정렬
        if (reversedPosts.length === 0) {
            infiniteLoadingContainer.style.display = "block";
        }
        return reversedPosts;
    }
    function appendPost(free) {
        const div = document.createElement('div');
        div.innerHTML = `
      <div class="community-list">
        <div class="my-page-community-list">
            <div class="c-typography">
                <div class="justify-content-between">
                      <div class="align-items-center">
                    <div class="f-semi-bold">${free.postCategory}</div>
                    </div>
                    <div class="align-items-center">
                    <button type="button" class="c-narrow-button">
                    <div class="c-narrow-button--icon"></div>
                        취소
                    <div class="c-narrow-button--icon"></div>
                    </button>
                    </div>
                </div>
                <div class="my-page-community">${free.postTitle}</div>
                 <div class="my-page-community-list-item-content">${free.postContent}</div>
                <div class="flex-column">
                    <div class="text-right">${timeForToday(free.postWriteDate)}</div>
                </div>
            </div>
        </div>
      </div>
       <hr class="horizontal line">
      `
        first.appendChild(div);
    }
    // 한번에 보여줄 리스트의 갯수를 정하고 차츰 페이지를 증가시킨다
    function showList() {
        // 중복되어 실행되는 경우가 있어 그것을 막기위해 로딩 유무 파악
        if (isLoading) return;

        isLoading = true;
        getPosts().then((posts) => {
            const rowCount = 7;
            const offset = (page - 1) * rowCount;
            const limit = offset + rowCount;
            posts = posts.slice(offset, limit);

            if(posts.length > 0) {
                posts.forEach((post) => {
                    appendPost(post);
                });
                page++;
            }
            isLoading = false;
        })
    }
    // 스크롤의 위치를 검색하고 조건에 맞춰 실행하는 함수
    function handleScroll() {
        // 현재 문서의 상단에서 스크롤바의 위치까지의 거리를 나타내는 값을 가져온다.
        const scrollTop = document.documentElement.scrollTop;
        // 현재 창의 뷰포트 높이를 나타낸다.
        const windowHeight = window.innerHeight;
        // 문서의 총 높이를 나타내는 값을 가져온다.
        const totalHeight = document.documentElement.scrollHeight;
        // 스크롤바가 문서의 아래쪽 끝에 도달했을 때 아래의 코드를 실행한다.
        if (scrollTop + windowHeight >= totalHeight - 1) {
            showList();
        }
    }
    // 스크롤 이벤트가 발생할 때마다 스크롤바의 위치를 검사하여 새로운 콘텐츠를 불러오게 된다.
    window.addEventListener("scroll", handleScroll);
    // 최초 실행하여 1페이지를 보여준다
    showList();

    function timeForToday(datetime) {
        const today = new Date();
        const date = new Date(datetime);
        let gap = Math.floor((today.getTime() - date.getTime()) / 1000 / 60);

        if (gap < 1) {
            return "방금 전";
        }

        if (gap < 60) {
            return `${gap}분 전`;
        }

        gap = Math.floor(gap / 60);

        if (gap < 24) {
            return `${gap}시간 전`;
        }

        gap = Math.floor(gap / 24);

        if (gap < 32) {
            return `${gap}일 전`;
        }

        gap = Math.floor(gap / 31);

        if (gap < 13) {
            return `${gap}개월 전`;
        }

        gap = Math.floor(gap / 12);

        return `${gap}년 전`
    }
</script>
</html>